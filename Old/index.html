<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title id="t-window-title">Bambi P2S Control</title>
    <style>
      :root {
        --accent: #00e676;
        --bg: #121212;
        --card: #1e1e1e;
        --text: #f0f0f0;
      }
      body {
        font-family: "Segoe UI", Tahoma, sans-serif;
        background: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 20px;
        overflow-x: hidden;
      }

      /* Layout */
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      .card {
        background: var(--card);
        padding: 20px;
        border-radius: 12px;
        border: 1px solid #333;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
      }
      .full-width {
        grid-column: span 2;
      }

      /* Typography */
      h2 {
        color: var(--accent);
        margin-top: 0;
        font-size: 1.1rem;
        border-bottom: 1px solid #333;
        padding-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      label {
        display: block;
        font-size: 0.85rem;
        color: #aaa;
        margin-bottom: 5px;
        margin-top: 10px;
      }

      /* Inputs & Buttons */
      input {
        width: 100%;
        padding: 10px;
        background: #2a2a2a;
        border: 1px solid #444;
        color: white;
        border-radius: 6px;
        box-sizing: border-box;
        outline: none;
        transition: border 0.3s;
      }
      input:focus {
        border-color: var(--accent);
      }
      .row {
        display: flex;
        gap: 10px;
        align-items: flex-end;
      }

      button {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
        margin-top: 10px;
      }
      .btn-blue {
        background: #2196f3;
        color: white;
      }
      .btn-green {
        background: var(--accent);
        color: black;
      }
      .btn-orange {
        background: #ff9800;
        color: white;
      }
      button:hover {
        filter: brightness(1.2);
        transform: translateY(-1px);
      }
      button:active {
        transform: translateY(0);
      }

      /* Monitor */
      .status-box {
        background: #000;
        padding: 15px;
        border-radius: 8px;
        font-family: "Consolas", monospace;
        color: #00ff00;
        margin-bottom: 20px;
        border-left: 4px solid var(--accent);
      }
      .status-box span {
        color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="status-box">
      <span id="t-mon-printer">Drucker</span>:
      <span id="m-status">Offline</span> | <span id="t-mon-temp">Temp</span>:
      <span id="m-temp">0</span>°C / <span id="m-target">0</span>°C |
      <span id="t-mon-spools">Spulen</span>: <span id="m-count">0</span>
    </div>

    <div class="grid">
      <div class="card">
        <h2 id="t-servo-title">Servo Einstellungen</h2>
        <div class="row">
          <div style="flex: 1">
            <label id="t-label-open">Öffnungswinkel</label>
            <input type="number" id="val-open" />
          </div>
          <div style="flex: 1">
            <label id="t-label-close">Schließwinkel</label>
            <input type="number" id="val-close" />
          </div>
        </div>

        <label id="t-label-test">Winkel testen</label>
        <div class="row">
          <input type="number" id="val-test" placeholder="..." />
          <button class="btn-orange" id="t-btn-go" onclick="testAngle()">
            GO
          </button>
        </div>
        <button
          class="btn-blue"
          id="t-btn-save-esp"
          onclick="saveToEsp()"
        ></button>
      </div>

      <div class="card">
        <h2 id="t-bot-title">Bot Konfiguration</h2>
        <label id="t-label-delay">Verzögerung (ms)</label>
        <input type="number" id="val-delay" />

        <div class="row">
          <div style="flex: 1">
            <label>Taskbar X,Y</label>
            <input type="text" id="pos-taskbar" />
          </div>
          <div style="flex: 1">
            <label>Print X,Y</label>
            <input type="text" id="pos-print" />
          </div>
        </div>
        <button
          class="btn-green"
          id="t-btn-start-bot"
          onclick="runBot()"
        ></button>
      </div>

      <div class="card full-width">
        <h2>Gcode Generator</h2>
        <p style="color: #666" id="t-gcode-placeholder">
          Warten auf Informationen...
        </p>
      </div>
    </div>

    <script>
      const { ipcRenderer } = require("electron");

      // Initialisierung durch die index.js
      ipcRenderer.on("init-app", (event, data) => {
        const { config, i18n } = data;

        // 1. Texte (Übersetzungen) setzen
        document.getElementById("t-window-title").innerText = i18n.title;
        document.getElementById("t-mon-printer").innerText =
          i18n.monitor.printer;
        document.getElementById("t-mon-temp").innerText = i18n.monitor.temp;
        document.getElementById("t-mon-spools").innerText = i18n.monitor.spools;

        document.getElementById("t-servo-title").innerText = i18n.servo.title;
        document.getElementById("t-label-open").innerText = i18n.servo.open;
        document.getElementById("t-label-close").innerText = i18n.servo.close;
        document.getElementById("t-label-test").innerText = i18n.servo.test;
        document.getElementById("t-btn-save-esp").innerText = i18n.servo.save;

        document.getElementById("t-bot-title").innerText = i18n.bot.title;
        document.getElementById("t-label-delay").innerText = i18n.bot.delay;
        document.getElementById("t-btn-start-bot").innerText = i18n.bot.run;

        // 2. Werte aus der Config laden
        document.getElementById("val-open").value = config.servoOpen;
        document.getElementById("val-close").value = config.servoClose;
        document.getElementById("val-delay").value = config.clickDelay;
        document.getElementById("pos-taskbar").value = config.posTaskbar;
        document.getElementById("pos-print").value = config.posPrint;
      });

      // Live-Daten Updates
      ipcRenderer.on("printer-data", (event, data) => {
        document.getElementById("m-status").innerText = data.status;
        document.getElementById("m-temp").innerText = data.currentTemp;
        document.getElementById("m-target").innerText = data.targetTemp;
        document.getElementById("m-count").innerText = data.spoolsDone;
      });

      // Funktionen für Buttons
      function testAngle() {
        const angle = document.getElementById("val-test").value;
        if (angle) ipcRenderer.send("serial-command", `GOTO:${angle}`);
      }

      function saveToEsp() {
        const values = {
          servoOpen: document.getElementById("val-open").value,
          servoClose: document.getElementById("val-close").value,
        };
        ipcRenderer.send("save-config", values);
      }

      function runBot() {
        const data = {
          delay: document.getElementById("val-delay").value,
          posTaskbar: document.getElementById("pos-taskbar").value,
          posPrint: document.getElementById("pos-print").value,
        };
        ipcRenderer.send("start-bot", data);
      }
    </script>
  </body>
</html>
